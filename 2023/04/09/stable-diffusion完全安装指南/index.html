
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="墨说有话">
    <title>Stable Diffusion 本地部署安装指南 - 墨说有话</title>
    <meta name="author" content="墨大先生">
    
    
        <link rel="icon" href="http://chenzp.top/assets/images/favicon.ico">
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"墨大先生","sameAs":["/all-wechat","https://facebook.com/simon.chen.5473894","mailto:2545229027@qq.com","/atom.xml","#about"],"image":"gravatar.png"},"articleBody":"\n\n\n\n电脑显卡不是NVIDIA的道友可以直接放弃了。最低4GB显存能跑，但生图效率感人，请酌情安装。\n\n\n\n\n\n前言\n什么是Stable Diffusion？\n用Stable Diffusion能做什么？\nStable Diffusion相比其他AI生图应用的优势是什么？\n为什么要学习使用Stable Diffusion？\nStable Diffusion可运行最低配置\n安装注意事项\n\n\n环境配置\n1. Anaconda\n1.1 Anaconda安装\n1.2 Anaconda配置\n\n\n2. Python\n2.1 下载安装\n2.2 Windows PowerShell设置\n\n\n3. Git\n\n\n部署应用\n1. 下载Stable Diffusion\n2. 检查webui-user.bat\n3. 安装Stable Diffusion\n\n\n常见问题\n1. pip问题及处理方法\n2. 报错：Couldn’t install gfpgan\n3. 报错：No module ‘xformers’. Proceeding without it.\n4. 报错：modulenotfounderror\n\n\n要点总结\n关于安装Stable Diffusion\n资源链接\n\n\n\n\n前言什么是Stable Diffusion？Stable Diffusion是一个文本到图像的潜在扩散模型，由CompVis、Stability AI和LAION的研究人员和工程师创建。它使用来自LAION-5B数据库子集的512x512图像进行训练。使用这个模型，可以生成包括人脸在内的任何图像。因为有大量开源的预训练模型，所以我们也可以在自己的机器上运行它。官网介绍：https://stability.ai/blog/stable-diffusion-public-release\n用Stable Diffusion能做什么？它的主要功能是使用文本描述、现有图片或指定训练模型产生新的图像。\nStable Diffusion相比其他AI生图应用的优势是什么？\n有大量开源模型，可本地部署运行，无需额外付费。\n训练模型参数、精度可深度控制，定制生图所见即所得。\n丰富的应用插件，可拓展性强。\n\n为什么要学习使用Stable Diffusion？\nAI作为未来重要且高效的生产力工具，我们必须掌握如何使用它。\n“xxx从业者即将失业”、“AI即将取代人类工作”等论调甚嚣尘上，通过学习破除焦虑心态。\n\nStable Diffusion可运行最低配置操作系统：Windows、MacOS 或 Linux显卡：Nvidia RTX 2050 以上VRAM显存：4GB硬盘空间：12GB以上\n安装注意事项\n需要具备科学上网条件，大多数资源安装会用到。\n在Stable Diffusion部署过程中所有软件安装的路径严禁出现中文、空格。\n电脑的用户名不能有中文。\n\n\n\n环境配置1. AnacondaAnaconda是一个运行python的环境管理工具。\n1.1 Anaconda安装官网下载链接https://www.anaconda.com/products/distribution。点击“Download”下载，打开文件一路“Next”到这个界面，勾上第一个选项，把该命令注册到环境变量。\n\n\n点击“Install”开始安装。安装完成后，点击“开始”菜单，可在“最近添加”里看到Anaconda Prompt，建议右键“更多-以管理员身份运行”。\n\n\n\n\n1.2 Anaconda配置后续需要下载Python包运行生成环境，如果Python下载失败或速度较慢，建议替换下载源。替换下载源方法如下：运行Anaconda Prompt，在打开的窗口输入以下命令进行全局配置。\npip config set global.index-url https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple\n打开“此电脑”，进入 C:\\Users\\&lt;电脑用户名&gt;这个路径，可以看到.condarc文件。打开它，我这里用的是Sublime Text，用记事本也行。复制以下内容进去，然后保存文件。\ndefault_channels:\n  - https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;main\n  - https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;r\n  - https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;msys2\ncustom_channels:\n  conda-forge: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud\n  msys2: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud\n  bioconda: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud\n  menpo: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud\n  pytorch: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud\n  pytorch-lts: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud\n  simpleitk: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud\nshow_channel_urls: true\nssl_verify: false\n\n\n2. Python2.1 下载安装Python官网下载链接https://www.python.org/downloads/release/python-3106/。完成下载后运行安装程序，安装界面中“Add Python3.10 to PATH”（将Python加入环境变量）前面要打勾 ，然后直接安装。\n\n\n\n2.2 Windows PowerShell设置右键Windows菜单图标打开Windows PowerShell(管理员模式)，输入如下命令：Set-ExecutionPolicy -ExecutionPolicy RemoteSigned出现下面选择栏按[A]回车。\n\n\n\n注意：\n\n建议下载Python版本为3.10.6，较新的版本可能会在后续过程中出现因找不到匹配资源报错而无法完成部署，所以这里需要下载的版本不是越新越好。\n如安装过程中忘记勾选“Add Python3.10 to PATH”可参考如下操作将Python加入环境变量。\n\n\n\n\n3. Git进入Git下载链接，https://git-scm.com/downloads。点击“Download for Windows”，下载完成后一路默认下一步，完成安装即可。\n部署应用1. 下载Stable Diffusion运行Anaconda Prompt窗口，进入到你想要进入的目录（注意文件路径不要有中文）。刚进来的目录是C:\\Windows\\system32，比如我这里想要放置的目录是D:\\git_pro，则依次输入以下命令：cd ../..cd D:cd git_pro\n输入如下命令，将Stable Diffusion应用克隆到刚刚打开的本地目录：\ngit clone https:&#x2F;&#x2F;github.com&#x2F;AUTOMATIC1111&#x2F;stable-diffusion-webui\n如果克隆速度很慢或连接失败，则可直接访问https://github.com/AUTOMATIC1111/stable-diffusion-webui，手动下载应用代码包并解压到本地目录。\n2. 检查webui-user.bat记事本打开webui-user.bat，修改Python应用程序路径为本地python.exe所在文件夹。\n@echo off\n\nset PYTHON&#x3D;&quot;D:\\python\\python.exe&quot;\nset GIT&#x3D;\nset VENV_DIR&#x3D;\nset COMMANDLINE_ARGS&#x3D;--xformers\n\ncall webui.bat\n\n3. 安装Stable Diffusion进入 stable-diffusion-webui\\目录，运行webui-user.bat 它会自己安装。注意：\n\n安装过程视网络状态可能会有多次中断（一部分模型在国外）。\n但凡报错中断之后，只需要重新运行webui-user.bat,程序会继续安装过程。\n一般来说，反复来个十多次很正常，请有足够耐心。\n\n安装完毕之后，会出现如下界面：\n\n\n\n如果安装过程顺利，在浏览器输入红框处的地址http://127.0.0.1:7860 ，就能访问到stable diffusion的本地服务了，这时候应该能看到下面的画面。\n\n\n\n\n常见问题1. pip问题及处理方法主要解决打包之后运行程序闪退，图片资源无法打包的问题。\n\npip安装指令：pip install pyinstaller\n\n如果报“’pip’ 不是内部或外部命令，也不是可运行的程序或批处理文件”，那么说明没有配置Python环境变量:\n\n右键“我的电脑——属性——高级系统设置——环境变量”。\n用户变量对系统安全，但作用域只在本用户。而系统变量作用域在整个电脑，在path变量中添加python的\\python\\Scripts路径，因为下面有你的pip.exe，告诉cmd去哪里找pip。\n\n如果报错为：\nWARNING: You are using pip version 19.2.3, however version 20.2.2\nis available.You should consider upgrading\nvia the ‘python -m pip install --upgrade pip’ command.\n或者:\nTraceback (most recent call last):\nFile “e:\\rj\\python37\\lib\\runpy.py”, line 193, in _run_module_as_main\n“main”, mod_spec)\nFile “e:\\rj\\python37\\lib\\runpy.py”, line 85, in run_code\nexec(code, run_globals)\nFile &quot;E:\\RJ\\python37\\Scripts\\pip.exe_main.py&quot;, line 5, in\nModuleNotFoundError: No module named ‘pip’\n则说明pip版本过低或者损坏，需要更新一下。\n如果是line4报错，一般是pip版本和python版本不匹配，常在更新pip时出现，输入python -m ensurepip匹配正确pip版本就好。\n在cmd中执行pip install --upgrade pip，等待pip和pyinstaller安装好即可开始使用。\n更多pip问题及解决方案参考：\n\npip常见问题，以及Pyinstaller 打包之后运行程序闪退，图片资源无法打包的问题\nPyinstaller使用笔记\n\n\n\n2. 报错：Couldn’t install gfpgan资源链接问题，可编辑stable-diffusion-webui文件夹中的“launch.py”，在每个资源链接前加上代理“https://ghproxy.com/” ，代码块如下：\ndef prepare_environment():\n    global skip_install\n\n    torch_command &#x3D; os.environ.get(&#39;TORCH_COMMAND&#39;, &quot;pip install torch&#x3D;&#x3D;1.13.1+cu117 torchvision&#x3D;&#x3D;0.14.1+cu117 --extra-index-url https:&#x2F;&#x2F;download.pytorch.org&#x2F;whl&#x2F;cu117&quot;)\n    requirements_file &#x3D; os.environ.get(&#39;REQS_FILE&#39;, &quot;requirements_versions.txt&quot;)\n\n    xformers_package &#x3D; os.environ.get(&#39;XFORMERS_PACKAGE&#39;, &#39;xformers&#x3D;&#x3D;0.0.16rc425&#39;)\n    gfpgan_package &#x3D; os.environ.get(&#39;GFPGAN_PACKAGE&#39;, &quot;git+https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;TencentARC&#x2F;GFPGAN.git@8d2447a2d918f8eba5a4a01463fd48e45126a379&quot;)\n    clip_package &#x3D; os.environ.get(&#39;CLIP_PACKAGE&#39;, &quot;git+https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;openai&#x2F;CLIP.git@d50d76daa670286dd6cacf3bcd80b5e4823fc8e1&quot;)\n    openclip_package &#x3D; os.environ.get(&#39;OPENCLIP_PACKAGE&#39;, &quot;git+https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;mlfoundations&#x2F;open_clip.git@bb6e834e9c70d9c27d0dc3ecedeebeaeb1ffad6b&quot;)\n\n    stable_diffusion_repo &#x3D; os.environ.get(&#39;STABLE_DIFFUSION_REPO&#39;, &quot;https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;Stability-AI&#x2F;stablediffusion.git&quot;)\n    taming_transformers_repo &#x3D; os.environ.get(&#39;TAMING_TRANSFORMERS_REPO&#39;, &quot;https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;CompVis&#x2F;taming-transformers.git&quot;)\n    k_diffusion_repo &#x3D; os.environ.get(&#39;K_DIFFUSION_REPO&#39;, &#39;https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;crowsonkb&#x2F;k-diffusion.git&#39;)\n    codeformer_repo &#x3D; os.environ.get(&#39;CODEFORMER_REPO&#39;, &#39;https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;sczhou&#x2F;CodeFormer.git&#39;)\n    blip_repo &#x3D; os.environ.get(&#39;BLIP_REPO&#39;, &#39;https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;salesforce&#x2F;BLIP.git&#39;)\n\n    stable_diffusion_commit_hash &#x3D; os.environ.get(&#39;STABLE_DIFFUSION_COMMIT_HASH&#39;, &quot;47b6b607fdd31875c9279cd2f4f16b92e4ea958e&quot;)\n    taming_transformers_commit_hash &#x3D; os.environ.get(&#39;TAMING_TRANSFORMERS_COMMIT_HASH&#39;, &quot;24268930bf1dce879235a7fddd0b2355b84d7ea6&quot;)\n    k_diffusion_commit_hash &#x3D; os.environ.get(&#39;K_DIFFUSION_COMMIT_HASH&#39;, &quot;5b3af030dd83e0297272d861c19477735d0317ec&quot;)\n    codeformer_commit_hash &#x3D; os.environ.get(&#39;CODEFORMER_COMMIT_HASH&#39;, &quot;c5b4593074ba6214284d6acd5f1719b6c5d739af&quot;)\n    blip_commit_hash &#x3D; os.environ.get(&#39;BLIP_COMMIT_HASH&#39;, &quot;48211a1594f1321b00f14c9f7a5b4813144b2fb9&quot;)\n\n\n\n\n3. 报错：No module ‘xformers’. Proceeding without it.编辑stable-diffusion-webui目录中的“webui-user.bat”文件，添加–xformers参数，如下：\nset COMMANDLINE_ARGS&#x3D;--xformers\n\n\n4. 报错：modulenotfounderror若报错信息为：\nmodulenotfounderror: no module named &#39;font_roboto&#39;\n则用Everything搜索roboto,然后把图中这三个文件删除（或者把所有搜索到的roboto字体全删除）\n\n\n\n\n\n要点总结关于安装Stable Diffusion\n从原版仅支持6G显存以上显卡优化到目前仅仅需要4G显存的显卡（理论上甚至仅用CPU都可以跑，速度很慢，不推荐）。\nStable Diffusion的安装整体不难，但也有点考验外网的连通性。好用的通道是前提。\n需要大量安装各种python库，可以考虑设置PIP国内源。\n安装目录尽可能不要放在C盘，安装位置要留出足够的空间，建议50GB以上。\n\n\n资源链接元素法典制作委员会：https://space.bilibili.com/1981251194Controlnet-models：https://huggingface.co/Hetaneko/Controlnet-models/PromptHero：https://prompthero.com/Civitai：https://civitai.com/Lexica：https://lexica.art/","dateCreated":"2023-04-09T00:00:00+08:00","dateModified":"2023-04-10T22:51:08+08:00","datePublished":"2023-04-09T00:00:00+08:00","description":"\n在自己的电脑上部署运行Stable Diffusion，实现AI 定制可爱的小姐姐 生成图片。\n","headline":"Stable Diffusion 本地部署安装指南","image":["thumb.png"],"mainEntityOfPage":{"@type":"WebPage","@id":"http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"},"publisher":{"@type":"Organization","name":"墨大先生","sameAs":["/all-wechat","https://facebook.com/simon.chen.5473894","mailto:2545229027@qq.com","/atom.xml","#about"],"image":"gravatar.png","logo":{"@type":"ImageObject","url":"gravatar.png"}},"url":"http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/","keywords":"AI, 瞎折腾","thumbnailUrl":"thumb.png"}</script>
    <meta name="description" content="在自己的电脑上部署运行Stable Diffusion，实现AI 定制可爱的小姐姐 生成图片。">
<meta property="og:type" content="blog">
<meta property="og:title" content="Stable Diffusion 本地部署安装指南">
<meta property="og:url" content="http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="墨说有话">
<meta property="og:description" content="在自己的电脑上部署运行Stable Diffusion，实现AI 定制可爱的小姐姐 生成图片。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/20230409_01_img-001.webp">
<meta property="og:image" content="http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/20230409_01_img-002.webp">
<meta property="og:image" content="http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/20230409_01_img-003.webp">
<meta property="og:image" content="http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/20230409_01_img-004.webp">
<meta property="og:image" content="http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/20230409_01_img-005.png">
<meta property="og:image" content="http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/20230409_01_img-006.webp">
<meta property="og:image" content="http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/20230409_01_img-007.webp">
<meta property="article:published_time" content="2023-04-08T16:00:00.000Z">
<meta property="article:modified_time" content="2023-04-10T14:51:08.429Z">
<meta property="article:author" content="墨大先生">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="瞎折腾">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/20230409_01_img-001.webp">
    
    
        
    
    
        <meta property="og:image" content="http://chenzp.top/assets/images/gravatar.png"/>
    
    
        <meta property="og:image" content="http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/thumb.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/thumb.png"/>
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-n59bsyxki0njjmdr4ivh6mcsq5perr0vbwobztcvyrqayrjgicbzeym5irjd.min.css">

    <!--STYLES END-->
    

    

    
        
            
<link rel="stylesheet" href="/assets/css/gitalk.css">

        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            墨说有话
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打开链接: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/gravatar.png" alt="作者的图片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="阅读有关作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/gravatar.png" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">墨大先生</h4>
                
                    <h5 class="sidebar-profile-bio"><p>听弦断，难解三千痴缠。<br><br></p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="首页"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="分类"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="标签"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="/all-archives"
                            
                            rel="noopener"
                            title="归档"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-wechat"
                            
                            rel="noopener"
                            title="微信"
                        >
                        <i class="sidebar-button-icon fab fa-weixin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">微信</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://facebook.com/simon.chen.5473894"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="脸书"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">脸书</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:2545229027@qq.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="邮箱"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="关于"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Stable Diffusion 本地部署安装指南
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2023-04-09T00:00:00+08:00">
	
		    4月 09, 2023
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <!-- excerpt -->
<br>

<blockquote>
<p>电脑显卡不是NVIDIA的道友可以直接放弃了。<br>最低4GB显存能跑，但生图效率感人，请酌情安装。</p>
</blockquote>
<br>
<br>

<ul>
<li><a href="#%E5%89%8D%E8%A8%80">前言</a><ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFStable-Diffusion%EF%BC%9F">什么是Stable Diffusion？</a></li>
<li><a href="#%E7%94%A8Stable-Diffusion%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F">用Stable Diffusion能做什么？</a></li>
<li><a href="#Stable-Diffusion%E7%9B%B8%E6%AF%94%E5%85%B6%E4%BB%96AI%E7%94%9F%E5%9B%BE%E5%BA%94%E7%94%A8%E7%9A%84%E4%BC%98%E5%8A%BF%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F">Stable Diffusion相比其他AI生图应用的优势是什么？</a></li>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8Stable-Diffusion%EF%BC%9F">为什么要学习使用Stable Diffusion？</a></li>
<li><a href="#Stable-Diffusion%E5%8F%AF%E8%BF%90%E8%A1%8C%E6%9C%80%E4%BD%8E%E9%85%8D%E7%BD%AE">Stable Diffusion可运行最低配置</a></li>
<li><a href="#%E5%AE%89%E8%A3%85%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">安装注意事项</a></li>
</ul>
</li>
<li><a href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">环境配置</a><ul>
<li><a href="#1-Anaconda">1. Anaconda</a><ul>
<li><a href="#1-1-Anaconda%E5%AE%89%E8%A3%85">1.1 Anaconda安装</a></li>
<li><a href="#1-2-Anaconda%E9%85%8D%E7%BD%AE">1.2 Anaconda配置</a></li>
</ul>
</li>
<li><a href="#2-Python">2. Python</a><ul>
<li><a href="#2-1-%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85">2.1 下载安装</a></li>
<li><a href="#2-2-Windows-PowerShell%E8%AE%BE%E7%BD%AE">2.2 Windows PowerShell设置</a></li>
</ul>
</li>
<li><a href="#3-Git">3. Git</a></li>
</ul>
</li>
<li><a href="#%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8">部署应用</a><ul>
<li><a href="#1-%E4%B8%8B%E8%BD%BDStable-Diffusion">1. 下载Stable Diffusion</a></li>
<li><a href="#2-%E6%A3%80%E6%9F%A5webui-user-bat">2. 检查webui-user.bat</a></li>
<li><a href="#3-%E5%AE%89%E8%A3%85Stable-Diffusion">3. 安装Stable Diffusion</a></li>
</ul>
</li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">常见问题</a><ul>
<li><a href="#1-pip%E9%97%AE%E9%A2%98%E5%8F%8A%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95">1. pip问题及处理方法</a></li>
<li><a href="#2-%E6%8A%A5%E9%94%99%EF%BC%9ACouldn%E2%80%99t-install-gfpgan">2. 报错：Couldn’t install gfpgan</a></li>
<li><a href="#3-%E6%8A%A5%E9%94%99%EF%BC%9ANo-module-%E2%80%98xformers%E2%80%99-Proceeding-without-it">3. 报错：No module ‘xformers’. Proceeding without it.</a></li>
<li><a href="#4-%E6%8A%A5%E9%94%99%EF%BC%9Amodulenotfounderror">4. 报错：modulenotfounderror</a></li>
</ul>
</li>
<li><a href="#%E8%A6%81%E7%82%B9%E6%80%BB%E7%BB%93">要点总结</a><ul>
<li><a href="#%E5%85%B3%E4%BA%8E%E5%AE%89%E8%A3%85Stable-Diffusion">关于安装Stable Diffusion</a></li>
<li><a href="#%E8%B5%84%E6%BA%90%E9%93%BE%E6%8E%A5">资源链接</a><br>
<br></li>
</ul>
</li>
</ul>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a><font style="color:#0099ff;">前言</font></h3><h5 id="什么是Stable-Diffusion？"><a href="#什么是Stable-Diffusion？" class="headerlink" title="什么是Stable Diffusion？"></a>什么是Stable Diffusion？</h5><p>Stable Diffusion是一个文本到图像的潜在扩散模型，由CompVis、Stability AI和LAION的研究人员和工程师创建。它使用来自LAION-5B数据库子集的512x512图像进行训练。使用这个模型，可以生成包括人脸在内的任何图像。因为有大量开源的预训练模型，所以我们也可以在自己的机器上运行它。<br>官网介绍：<a target="_blank" rel="noopener" href="https://stability.ai/blog/stable-diffusion-public-release">https://stability.ai/blog/stable-diffusion-public-release</a></p>
<h5 id="用Stable-Diffusion能做什么？"><a href="#用Stable-Diffusion能做什么？" class="headerlink" title="用Stable Diffusion能做什么？"></a>用Stable Diffusion能做什么？</h5><p>它的主要功能是使用文本描述、现有图片或指定训练模型产生新的图像。</p>
<h5 id="Stable-Diffusion相比其他AI生图应用的优势是什么？"><a href="#Stable-Diffusion相比其他AI生图应用的优势是什么？" class="headerlink" title="Stable Diffusion相比其他AI生图应用的优势是什么？"></a>Stable Diffusion相比其他AI生图应用的优势是什么？</h5><ul>
<li>有大量开源模型，可本地部署运行，无需额外付费。</li>
<li>训练模型参数、精度可深度控制，定制生图所见即所得。</li>
<li>丰富的应用插件，可拓展性强。</li>
</ul>
<h5 id="为什么要学习使用Stable-Diffusion？"><a href="#为什么要学习使用Stable-Diffusion？" class="headerlink" title="为什么要学习使用Stable Diffusion？"></a>为什么要学习使用Stable Diffusion？</h5><ul>
<li>AI作为未来重要且高效的生产力工具，我们必须掌握如何使用它。</li>
<li>“xxx从业者即将失业”、“AI即将取代人类工作”等论调甚嚣尘上，通过学习破除焦虑心态。</li>
</ul>
<h5 id="Stable-Diffusion可运行最低配置"><a href="#Stable-Diffusion可运行最低配置" class="headerlink" title="Stable Diffusion可运行最低配置"></a>Stable Diffusion可运行最低配置</h5><p>操作系统：Windows、MacOS 或 Linux<br>显卡：Nvidia RTX 2050 以上<br>VRAM显存：4GB<br>硬盘空间：12GB以上</p>
<h5 id="安装注意事项"><a href="#安装注意事项" class="headerlink" title="安装注意事项"></a><font style="color:#FF0000;">安装注意事项</font></h5><ul>
<li><font style="color:#FF0000;">需要具备科学上网条件，大多数资源安装会用到。</font></li>
<li><font style="color:#FF0000;">在Stable Diffusion部署过程中所有软件安装的路径严禁出现中文、空格。</font></li>
<li><font style="color:#FF0000;">电脑的用户名不能有中文。</font><br>
<br>
<br></li>
</ul>
<h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a><font style="color:#0099ff;">环境配置</font></h3><h5 id="1-Anaconda"><a href="#1-Anaconda" class="headerlink" title="1. Anaconda"></a>1. Anaconda</h5><p>Anaconda是一个运行python的环境管理工具。</p>
<h6 id="1-1-Anaconda安装"><a href="#1-1-Anaconda安装" class="headerlink" title="1.1 Anaconda安装"></a>1.1 Anaconda安装</h6><p>官网下载链接<a target="_blank" rel="noopener" href="https://www.anaconda.com/products/distribution">https://www.anaconda.com/products/distribution</a>。<br>点击“Download”下载，打开文件一路“Next”到这个界面，勾上第一个选项，把该命令注册到环境变量。<br><br></p>
<center><img src="20230409_01_img-001.webp"></img></center>
<br>
点击“Install”开始安装。安装完成后，点击“开始”菜单，可在“最近添加”里看到Anaconda Prompt，建议右键“更多-以管理员身份运行”。
<br>
<center><img src="20230409_01_img-002.webp"></img></center>
<br>

<h6 id="1-2-Anaconda配置"><a href="#1-2-Anaconda配置" class="headerlink" title="1.2 Anaconda配置"></a>1.2 Anaconda配置</h6><p>后续需要下载Python包运行生成环境，如果Python下载失败或速度较慢，建议替换下载源。<br>替换下载源方法如下：<br>运行Anaconda Prompt，在打开的窗口输入以下命令进行全局配置。</p>
<pre class="line-numbers language-none"><code class="language-none">pip config set global.index-url https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>打开“此电脑”，进入<code> C:\Users\&lt;电脑用户名&gt;</code>这个路径，可以看到<code>.condarc</code>文件。<br>打开它，我这里用的是Sublime Text，用记事本也行。<br>复制以下内容进去，然后保存文件。</p>
<pre class="line-numbers language-none"><code class="language-none">default_channels:
  - https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;main
  - https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;r
  - https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;msys2
custom_channels:
  conda-forge: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud
  msys2: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud
  bioconda: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud
  menpo: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud
  pytorch: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud
  pytorch-lts: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud
  simpleitk: https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud
show_channel_urls: true
ssl_verify: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<br>

<h5 id="2-Python"><a href="#2-Python" class="headerlink" title="2. Python"></a>2. Python</h5><h6 id="2-1-下载安装"><a href="#2-1-下载安装" class="headerlink" title="2.1 下载安装"></a>2.1 下载安装</h6><p>Python官网下载链接<a target="_blank" rel="noopener" href="https://www.python.org/downloads/release/python-3106/">https://www.python.org/downloads/release/python-3106/</a>。<br>完成下载后运行安装程序，安装界面中“Add Python3.10 to PATH”（将Python加入环境变量）前面要打勾 ，然后直接安装。<br><br></p>
<center><img src="20230409_01_img-003.webp"></img></center>
<br>

<h6 id="2-2-Windows-PowerShell设置"><a href="#2-2-Windows-PowerShell设置" class="headerlink" title="2.2 Windows PowerShell设置"></a>2.2 Windows PowerShell设置</h6><p>右键Windows菜单图标打开Windows PowerShell(管理员模式)，输入如下命令：<br><code>Set-ExecutionPolicy -ExecutionPolicy RemoteSigned</code><br>出现下面选择栏按[A]回车。<br><br></p>
<center><img src="20230409_01_img-004.webp"></img></center>
<br>

<p><font style="color:#FF0000;">注意：</font></p>
<ul>
<li><font style="color:#FF0000;">建议下载Python版本为3.10.6，较新的版本可能会在后续过程中出现因找不到匹配资源报错而无法完成部署，所以这里需要下载的版本不是越新越好。</font></li>
<li><font style="color:#FF0000;">如安装过程中忘记勾选“Add Python3.10 to PATH”可参考如下操作<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/263000046">将Python加入环境变量</a>。</font></li>
</ul>
<br>
<br>

<h5 id="3-Git"><a href="#3-Git" class="headerlink" title="3. Git"></a>3. Git</h5><p>进入Git下载链接，<a target="_blank" rel="noopener" href="https://git-scm.com/downloads%E3%80%82">https://git-scm.com/downloads。</a><br>点击“Download for Windows”，下载完成后一路默认下一步，完成安装即可。<br><br><br><br></p>
<h3 id="部署应用"><a href="#部署应用" class="headerlink" title="部署应用"></a><font style="color:#0099ff;">部署应用</font></h3><h5 id="1-下载Stable-Diffusion"><a href="#1-下载Stable-Diffusion" class="headerlink" title="1. 下载Stable Diffusion"></a>1. 下载Stable Diffusion</h5><p>运行Anaconda Prompt窗口，进入到你想要进入的目录（注意文件路径不要有中文）。<br>刚进来的目录是<code>C:\Windows\system32</code>，比如我这里想要放置的目录是<code>D:\git_pro</code>，则依次输入以下命令：<br><code>cd ../..</code><br><code>cd D:</code><br><code>cd git_pro</code></p>
<p>输入如下命令，将Stable Diffusion应用克隆到刚刚打开的本地目录：</p>
<pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;AUTOMATIC1111&#x2F;stable-diffusion-webui<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果克隆速度很慢或连接失败，则可直接访问<a target="_blank" rel="noopener" href="https://github.com/AUTOMATIC1111/stable-diffusion-webui">https://github.com/AUTOMATIC1111/stable-diffusion-webui</a>，手动下载应用代码包并解压到本地目录。<br><br></p>
<h5 id="2-检查webui-user-bat"><a href="#2-检查webui-user-bat" class="headerlink" title="2. 检查webui-user.bat"></a>2. 检查webui-user.bat</h5><p>记事本打开webui-user.bat，修改Python应用程序路径为本地python.exe所在文件夹。</p>
<pre class="line-numbers language-none"><code class="language-none">@echo off

set PYTHON&#x3D;&quot;D:\python\python.exe&quot;
set GIT&#x3D;
set VENV_DIR&#x3D;
set COMMANDLINE_ARGS&#x3D;--xformers

call webui.bat
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="3-安装Stable-Diffusion"><a href="#3-安装Stable-Diffusion" class="headerlink" title="3. 安装Stable Diffusion"></a>3. 安装Stable Diffusion</h5><p>进入 stable-diffusion-webui\目录，运行webui-user.bat 它会自己安装。<br><font style="color:#FF0000;">注意：</font></p>
<ul>
<li><font style="color:#FF0000;">安装过程视网络状态可能会有多次中断（一部分模型在国外）。</font></li>
<li><font style="color:#FF0000;">但凡报错中断之后，只需要重新运行webui-user.bat,程序会继续安装过程。</font></li>
<li><font style="color:#FF0000;">一般来说，反复来个十多次很正常，请有足够耐心。</font></li>
</ul>
<p>安装完毕之后，会出现如下界面：<br><br></p>
<center><img src="20230409_01_img-005.png"></img></center>
<br>

<p>如果安装过程顺利，在浏览器输入红框处的地址<a target="_blank" rel="noopener" href="http://127.0.0.1:7860/">http://127.0.0.1:7860</a> ，就能访问到stable diffusion的本地服务了，这时候应该能看到下面的画面。<br><br></p>
<center><img src="20230409_01_img-006.webp"></img></center>
<br>
<br>

<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a><font style="color:#0099ff;">常见问题</font></h3><h5 id="1-pip问题及处理方法"><a href="#1-pip问题及处理方法" class="headerlink" title="1. pip问题及处理方法"></a>1. pip问题及处理方法</h5><p>主要解决打包之后运行程序闪退，图片资源无法打包的问题。</p>
<ul>
<li>pip安装指令：<code>pip install pyinstaller</code></li>
</ul>
<p>如果报“’pip’ 不是内部或外部命令，也不是可运行的程序或批处理文件”，那么说明没有配置Python环境变量:</p>
<ul>
<li>右键“我的电脑——属性——高级系统设置——环境变量”。</li>
<li>用户变量对系统安全，但作用域只在本用户。而系统变量作用域在整个电脑，在path变量中添加python的\python\Scripts路径，因为下面有你的pip.exe，告诉cmd去哪里找pip。</li>
</ul>
<p>如果报错为：</p>
<pre class="line-numbers language-none"><code class="language-none">WARNING: You are using pip version 19.2.3, however version 20.2.2
is available.You should consider upgrading
via the ‘python -m pip install --upgrade pip’ command.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>或者:</p>
<pre class="line-numbers language-none"><code class="language-none">Traceback (most recent call last):
File “e:\rj\python37\lib\runpy.py”, line 193, in _run_module_as_main
“main”, mod_spec)
File “e:\rj\python37\lib\runpy.py”, line 85, in run_code
exec(code, run_globals)
File &quot;E:\RJ\python37\Scripts\pip.exe_main.py&quot;, line 5, in
ModuleNotFoundError: No module named ‘pip’<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>则说明pip版本过低或者损坏，需要更新一下。</p>
<p>如果是<code>line4</code>报错，一般是pip版本和python版本不匹配，常在更新pip时出现，输入<code>python -m ensurepip</code>匹配正确pip版本就好。</p>
<p>在cmd中执行<code>pip install --upgrade pip</code>，等待pip和pyinstaller安装好即可开始使用。</p>
<p>更多pip问题及解决方案参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45508146/article/details/118913463">pip常见问题，以及Pyinstaller 打包之后运行程序闪退，图片资源无法打包的问题</a></li>
<li><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Pyinstaller&spm=1001.2101.3001.7020">Pyinstaller使用笔记</a><br>
<br>
<br></li>
</ul>
<h5 id="2-报错：Couldn’t-install-gfpgan"><a href="#2-报错：Couldn’t-install-gfpgan" class="headerlink" title="2. 报错：Couldn’t install gfpgan"></a>2. 报错：Couldn’t install gfpgan</h5><p>资源链接问题，可编辑stable-diffusion-webui文件夹中的“launch.py”，在每个资源链接前加上代理“<a target="_blank" rel="noopener" href="https://ghproxy.com/%E2%80%9D">https://ghproxy.com/”</a> ，代码块如下：</p>
<pre class="line-numbers language-none"><code class="language-none">def prepare_environment():
    global skip_install

    torch_command &#x3D; os.environ.get(&#39;TORCH_COMMAND&#39;, &quot;pip install torch&#x3D;&#x3D;1.13.1+cu117 torchvision&#x3D;&#x3D;0.14.1+cu117 --extra-index-url https:&#x2F;&#x2F;download.pytorch.org&#x2F;whl&#x2F;cu117&quot;)
    requirements_file &#x3D; os.environ.get(&#39;REQS_FILE&#39;, &quot;requirements_versions.txt&quot;)

    xformers_package &#x3D; os.environ.get(&#39;XFORMERS_PACKAGE&#39;, &#39;xformers&#x3D;&#x3D;0.0.16rc425&#39;)
    gfpgan_package &#x3D; os.environ.get(&#39;GFPGAN_PACKAGE&#39;, &quot;git+https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;TencentARC&#x2F;GFPGAN.git@8d2447a2d918f8eba5a4a01463fd48e45126a379&quot;)
    clip_package &#x3D; os.environ.get(&#39;CLIP_PACKAGE&#39;, &quot;git+https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;openai&#x2F;CLIP.git@d50d76daa670286dd6cacf3bcd80b5e4823fc8e1&quot;)
    openclip_package &#x3D; os.environ.get(&#39;OPENCLIP_PACKAGE&#39;, &quot;git+https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;mlfoundations&#x2F;open_clip.git@bb6e834e9c70d9c27d0dc3ecedeebeaeb1ffad6b&quot;)

    stable_diffusion_repo &#x3D; os.environ.get(&#39;STABLE_DIFFUSION_REPO&#39;, &quot;https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;Stability-AI&#x2F;stablediffusion.git&quot;)
    taming_transformers_repo &#x3D; os.environ.get(&#39;TAMING_TRANSFORMERS_REPO&#39;, &quot;https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;CompVis&#x2F;taming-transformers.git&quot;)
    k_diffusion_repo &#x3D; os.environ.get(&#39;K_DIFFUSION_REPO&#39;, &#39;https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;crowsonkb&#x2F;k-diffusion.git&#39;)
    codeformer_repo &#x3D; os.environ.get(&#39;CODEFORMER_REPO&#39;, &#39;https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;sczhou&#x2F;CodeFormer.git&#39;)
    blip_repo &#x3D; os.environ.get(&#39;BLIP_REPO&#39;, &#39;https:&#x2F;&#x2F;ghproxy.com&#x2F;https:&#x2F;&#x2F;github.com&#x2F;salesforce&#x2F;BLIP.git&#39;)

    stable_diffusion_commit_hash &#x3D; os.environ.get(&#39;STABLE_DIFFUSION_COMMIT_HASH&#39;, &quot;47b6b607fdd31875c9279cd2f4f16b92e4ea958e&quot;)
    taming_transformers_commit_hash &#x3D; os.environ.get(&#39;TAMING_TRANSFORMERS_COMMIT_HASH&#39;, &quot;24268930bf1dce879235a7fddd0b2355b84d7ea6&quot;)
    k_diffusion_commit_hash &#x3D; os.environ.get(&#39;K_DIFFUSION_COMMIT_HASH&#39;, &quot;5b3af030dd83e0297272d861c19477735d0317ec&quot;)
    codeformer_commit_hash &#x3D; os.environ.get(&#39;CODEFORMER_COMMIT_HASH&#39;, &quot;c5b4593074ba6214284d6acd5f1719b6c5d739af&quot;)
    blip_commit_hash &#x3D; os.environ.get(&#39;BLIP_COMMIT_HASH&#39;, &quot;48211a1594f1321b00f14c9f7a5b4813144b2fb9&quot;)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<br>
<br>

<h5 id="3-报错：No-module-‘xformers’-Proceeding-without-it"><a href="#3-报错：No-module-‘xformers’-Proceeding-without-it" class="headerlink" title="3. 报错：No module ‘xformers’. Proceeding without it."></a>3. 报错：No module ‘xformers’. Proceeding without it.</h5><p>编辑stable-diffusion-webui目录中的“webui-user.bat”文件，添加–xformers参数，如下：</p>
<pre class="line-numbers language-none"><code class="language-none">set COMMANDLINE_ARGS&#x3D;--xformers<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<br>

<h5 id="4-报错：modulenotfounderror"><a href="#4-报错：modulenotfounderror" class="headerlink" title="4. 报错：modulenotfounderror"></a>4. 报错：modulenotfounderror</h5><p>若报错信息为：</p>
<pre class="line-numbers language-none"><code class="language-none">modulenotfounderror: no module named &#39;font_roboto&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>则用Everything搜索roboto,然后把图中这三个文件删除（或者把所有搜索到的roboto字体全删除）<br><br></p>
<center><img src="20230409_01_img-007.webp"></img></center>
<br>
<br>
<br>

<h3 id="要点总结"><a href="#要点总结" class="headerlink" title="要点总结"></a><font style="color:#0099ff;">要点总结</font></h3><h5 id="关于安装Stable-Diffusion"><a href="#关于安装Stable-Diffusion" class="headerlink" title="关于安装Stable Diffusion"></a>关于安装Stable Diffusion</h5><ol>
<li>从原版仅支持6G显存以上显卡优化到目前仅仅需要4G显存的显卡（理论上甚至仅用CPU都可以跑，速度很慢，不推荐）。</li>
<li>Stable Diffusion的安装整体不难，但也有点考验外网的连通性。好用的通道是前提。</li>
<li>需要大量安装各种python库，可以考虑设置PIP国内源。</li>
<li>安装目录尽可能不要放在C盘，安装位置要留出足够的空间，建议50GB以上。<br>
<br></li>
</ol>
<h5 id="资源链接"><a href="#资源链接" class="headerlink" title="资源链接"></a>资源链接</h5><p>元素法典制作委员会：<a target="_blank" rel="noopener" href="https://space.bilibili.com/1981251194">https://space.bilibili.com/1981251194</a><br>Controlnet-models：<a target="_blank" rel="noopener" href="https://huggingface.co/Hetaneko/Controlnet-models/tree/main/controlnet_safetensors">https://huggingface.co/Hetaneko/Controlnet-models/</a><br>PromptHero：<a target="_blank" rel="noopener" href="https://prompthero.com/">https://prompthero.com/</a><br>Civitai：<a target="_blank" rel="noopener" href="https://civitai.com/">https://civitai.com/</a><br>Lexica：<a target="_blank" rel="noopener" href="https://lexica.art/">https://lexica.art/</a><br><br><br><br></p>
            


            <!-- copyright -->
            
                <div class="article-footer-copyright">
    <p><span>作者:</span><a href="/" title="访问 墨大先生的个人博客">墨大先生</a></p>
    <p><span>发布时间:</span>2023年04月09日 - 00:00</p>
    <p><span>原文链接：</span><a href="/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/" title="Stable Diffusion 本地部署安装指南">Stable Diffusion 本地部署安装指南</a>
    <p><span>许可协议:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
            
            <!-- copyright -->
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/AI/" rel="tag">AI</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/%E7%9E%8E%E6%8A%98%E8%85%BE/" rel="tag">瞎折腾</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2023/04/06/%E8%BE%9E%E6%97%A7%E8%BF%8E%E6%96%B0%E7%9A%84%E5%BC%80%E7%AF%87/"
                    data-tooltip="辞旧迎新的开篇"
                    aria-label="下一篇: 辞旧迎新的开篇"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"
                    title="分享到 Google+"
                    aria-label="分享到 Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#gitalk"
                        aria-label="Kommentieren"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="gitalk"></div>

            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2023 墨大先生. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2023/04/06/%E8%BE%9E%E6%97%A7%E8%BF%8E%E6%96%B0%E7%9A%84%E5%BC%80%E7%AF%87/"
                    data-tooltip="辞旧迎新的开篇"
                    aria-label="下一篇: 辞旧迎新的开篇"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"
                    title="分享到 Google+"
                    aria-label="分享到 Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#gitalk"
                        aria-label="Kommentieren"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"
                        aria-label="分享到 Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>分享到 Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"
                        aria-label="分享到 Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=http://chenzp.top/2023/04/09/stable-diffusion%E5%AE%8C%E5%85%A8%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"
                        aria-label="分享到 Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>分享到 Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/gravatar.png" alt="作者的图片"/>
        
            <h4 id="about-card-name">墨大先生</h4>
        
            <div id="about-card-bio"><p>听弦断，难解三千痴缠。<br><br></p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>设计师 / 斜杠青年</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-r70y3tvudvucdxxevl5cq4stbfizxdcnouznqw4tqrowoem5g3b1yv8nbtwq.min.js"></script>

<!--SCRIPTS END-->


    
        
<script src="/assets/js/gitalk.js"></script>

        <script type="text/javascript">
          (function() {
            new Gitalk({
              clientID: 'ba10062e3d8102da3e4e',
              clientSecret: 'f4bb945a4a3df0298ea6e05142f7ede92c3f85d3',
              repo: 'blog-comments.github.io',
              owner: 'mrmoda',
              admin: ['mrmoda'],
              id: '2023/04/09/stable-diffusion完全安装指南/',
              ...{"language":"zh-CN","perPage":10,"distractionFreeMode":false,"enableHotKey":true,"pagerDirection":"first"}
            }).render('gitalk')
          })()
        </script>
    




    </body>
</html>
